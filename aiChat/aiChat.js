(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/aiChat/aiChat"],{"0969":function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("f244");o(n("3240"));var a=o(n("ddc8"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"1e48":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={themeBackground:function(){return Promise.all([n.e("common/vendor"),n.e("components/theme-background/theme-background")]).then(n.bind(null,"327d"))},zPaging:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/z-paging/components/z-paging/z-paging")]).then(n.bind(null,"8765"))},chatItem:function(){return n.e("components/chat-item/chat-item").then(n.bind(null,"bec1"))},chatInputBar:function(){return Promise.all([n.e("common/vendor"),n.e("components/chat-input-bar/chat-input-bar")]).then(n.bind(null,"6f3e"))}},a=function(){var t=this.$createElement;this._self._c},i=[]},"4b76":function(t,e,n){"use strict";n.r(e);var o=n("b082"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a},"8eb5":function(t,e,n){"use strict";var o=n("8fdb"),a=n.n(o);a.a},"8fdb":function(t,e,n){},b082:function(t,e,n){"use strict";(function(t){var o=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("7eb4")),i=o(n("ee10")),r=o(n("af34")),c=n("ae6a");function s(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){c=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw i}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var l={components:{chatInputBar:function(){Promise.all([n.e("common/vendor"),n.e("components/chat-input-bar/chat-input-bar")]).then(function(){return resolve(n("6f3e"))}.bind(null,n)).catch(n.oe)},chatItem:function(){n.e("components/chat-item/chat-item").then(function(){return resolve(n("bec1"))}.bind(null,n)).catch(n.oe)}},data:function(){return{talkList:[],content:"",sendState:!1,id:"",type:0,icon:"",welcome:"请详细描述您的需求",allow:!1,roleText:""}},onShow:function(){this.$tool.setTheme(this.$store.state.currTheme.colors.primary)},onLoad:function(){var e=this.$Route.query;this.type=e.type;var n=e.t+" - AI助手";if(this.id=e.id,3==this.type){var o=this.$tool.get("CUSTOMAI");this.icon=o.avatar,this.welcome=o.welcome,this.roleText=o.content,this.allow=o.allow,n=o.title}else this.icon="/static/images/ai-".concat(this.id,".png");t.setNavigationBarTitle({title:n})},methods:{sendTxt:function(){var e,n=this,o=this.$tool.get(c.tokenInfoTableName),a=this.$tool.get("CHAT-".concat(this.type)),i=[],u=s(a);try{for(u.s();!(e=u.n()).done;){var l=e.value;i.push({content:l.content,type:l.type})}}catch(h){u.e(h)}finally{u.f()}var f=t.request({url:c.httpUrl+"api/busWall/streamChat",method:"POST",header:{Accept:"text/event-stream",Authorization:"Bearer ".concat(null===o||void 0===o?void 0:o.accessToken),"X-DashScope-SSE":"enable"},data:JSON.stringify({type:this.type,text:this.content,roleText:this.roleText,allow:this.allow,historyMessage:i}),enableChunked:!0,responseType:"arraybuffer",success:function(t){},fail:function(t){},complete:function(t){n.sendState=!1;var e=n.$tool.get("CHAT-".concat(n.type)),o={content:n.talkList[0].content,type:0,state:1,icon:n.icon,end:!0};e.unshift(o),n.$tool.set("CHAT-".concat(n.type),e)}});f.onChunkReceived((function(t){var e,o=t.data,a=Object.prototype.toString.call(o);if("[object Uint8Array]"===a)e=decodeURIComponent(escape(String.fromCharCode.apply(String,(0,r.default)(t.data))));else if(t.data instanceof ArrayBuffer){var i=new Uint8Array(t.data);e=decodeURIComponent(escape(String.fromCharCode.apply(String,(0,r.default)(i))))}n.talkList[0].state=1,n.talkList[0].content+=e}))},updateUserInfo:function(){},getHistoryMsg:function(){var t=this,e=this.$tool.get("CHAT-".concat(this.type)),n={content:this.welcome,type:0,state:0,icon:this.icon,end:!0};e||(e=[n],this.$tool.set("CHAT-".concat(this.type),e));var o=function(){var n=(0,i.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$refs.paging.complete(e);case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();o()},keyboardHeightChange:function(t){this.$refs.inputBar.updateKeyboardHeightChange(t)},hidedKeyboard:function(){this.$refs.inputBar.hidedKeyboard()},socketInit:function(){},onmessage:function(){},handleopen:function(){},send:function(t){if(this.content=t,this.sendState)return!1;this.$refs.inputBar.setMsg(""),this.sendState=!0;var e={content:t,type:1,state:1,icon:this.$config.imgUrl+this.userInfo.avatar};this.talkList.unshift(e);var n=this.$tool.get("CHAT-".concat(this.type));n.unshift(e),this.$tool.set("CHAT-".concat(this.type),n),this.talkList.unshift({content:"",type:0,state:0,end:!0,icon:this.icon}),this.sendTxt()}}};e.default=l}).call(this,n("df3c")["default"])},ddc8:function(t,e,n){"use strict";n.r(e);var o=n("1e48"),a=n("4b76");for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("8eb5");var r=n("828b"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=c.exports}},[["0969","common/runtime","common/vendor"]]]);